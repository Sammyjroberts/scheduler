<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Schedule Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }

    .timeline-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #visualization {
      margin-top: 20px;
    }

    .upload-area {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #2196F3;
    }

    .vis-item {
      border-radius: 4px;
      font-size: 12px;
    }

    .vis-item.chosen {
      background-color: #4CAF50;
      border-color: #388E3C;
      color: white;
    }

    .vis-item.rejected {
      background-color: #FF5252;
      border-color: #D32F2F;
      color: white;
      opacity: 0.7;
    }

    .vis-item.zero-duration {
      border-style: dashed !important;
    }

    .legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 8px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }

    .chosen-color {
      background-color: #4CAF50;
    }

    .rejected-color {
      background-color: #FF5252;
      opacity: 0.7;
    }

    .vis-labelset .vis-label {
      font-weight: bold;
      padding: 5px;
      color: #333;
    }
  </style>
</head>

<body>
  <div class="upload-area">
    <input type="file" id="fileInput" accept=".json">
    <p>Upload a schedule JSON file to visualize</p>
  </div>

  <div class="stats">
    <div class="stat-card">
      <h3>Total Tasks</h3>
      <div id="totalTasks" class="stat-value">-</div>
    </div>
    <div class="stat-card">
      <h3>Scheduled Tasks</h3>
      <div id="scheduledTasks" class="stat-value">-</div>
    </div>
    <div class="stat-card">
      <h3>Total Priority Score</h3>
      <div id="totalPriority" class="stat-value">-</div>
    </div>
  </div>

  <div class="timeline-container">
    <div id="visualization"></div>
  </div>

  <script>
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = function (event) {
        const data = JSON.parse(event.target.result);
        visualizeSchedule(data);
      };

      reader.readAsText(file);
    });

    function visualizeSchedule(data) {
      // Update statistics
      document.getElementById('totalTasks').textContent = data.statistics.total_tasks;
      document.getElementById('scheduledTasks').textContent = data.statistics.scheduled_tasks;
      document.getElementById('totalPriority').textContent = data.total_priority;

      // Define groups for chosen and rejected tasks
      const groups = new vis.DataSet([
        {
          id: 'chosen',
          content: 'Chosen Tasks (Optimal Schedule)',
          order: 1
        },
        {
          id: 'rejected',
          content: 'Rejected Tasks (Alternatives)',
          order: 2
        }
      ]);

      // Create items for the timeline
      const items = new vis.DataSet();

      // Add chosen tasks
      data.chosen_tasks.forEach((task, index) => {
        items.add({
          id: `chosen-${index}`,
          group: 'chosen',
          content: `Priority: ${task.priority}`,
          start: task.start_time,
          end: task.end_time,
          className: `chosen ${task.is_zero_duration ? 'zero-duration' : ''}`,
          title: `Priority: ${task.priority}\nDuration: ${task.duration_mins} mins\nStatus: Chosen`
        });
      });

      // Add rejected tasks
      data.rejected_tasks.forEach((task, index) => {
        items.add({
          id: `rejected-${index}`,
          group: 'rejected',
          content: `Priority: ${task.priority}`,
          start: task.start_time,
          end: task.end_time,
          className: `rejected ${task.is_zero_duration ? 'zero-duration' : ''}`,
          title: `Priority: ${task.priority}\nDuration: ${task.duration_mins} mins\nStatus: Rejected`
        });
      });

      // Configure timeline options
      const options = {
        start: data.time_range.start,
        end: data.time_range.end,
        timeAxis: { scale: 'minute', step: 15 },
        orientation: 'top',
        stack: true,
        showCurrentTime: false,
        zoomMin: 1000 * 60 * 60, // 1 hour
        zoomMax: 1000 * 60 * 60 * 24, // 24 hours
        height: '400px',
        margin: {
          item: {
            horizontal: 10,
            vertical: 5
          }
        }
      };

      // Create timeline
      const container = document.getElementById('visualization');
      new vis.Timeline(container, items, options, groups);
    }
  </script>
</body>

</html>